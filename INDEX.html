
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mental Health & Wellness Journal</title>

  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#0f1113; --card:#15181b; --accent:#ff7070; --muted:#9aa0a6; --glass: rgba(255,255,255,0.03);
      --glass-2: rgba(255,255,255,0.02);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter,ui-sans-serif,system-ui,Arial, sans-serif;
      background:linear-gradient(180deg,#070809 0%, #0f1113 100%); color:#e8eef2; padding:22px;
    }
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:18px}
    h1{font-size:20px;margin:0;color:var(--accent)}
    .controls {display:flex; gap:8px; align-items:center;}
    button{background:var(--accent); color:#fff; border:0; padding:8px 12px; border-radius:8px; cursor:pointer}
    .secondary{background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted)}
    .container{display:grid; grid-template-columns: 360px 1fr; gap:18px; align-items:start}
    .card{background:linear-gradient(180deg,var(--card),var(--glass)); padding:16px; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.6);}
    label{display:block;color:var(--muted);font-size:13px;margin-bottom:8px}
    #emojiContainer{display:flex;gap:8px;margin-bottom:12px}
    .emoji-option{
      font-size:28px; padding:10px; border-radius:10px; cursor:pointer; user-select:none;
      border:2px solid transparent; transform-origin:center; transition: transform 180ms cubic-bezier(.2,.9,.3,1), box-shadow 180ms;
      background:var(--glass-2)
    }
    .emoji-option.selected{ box-shadow:0 8px 22px rgba(0,0,0,0.6); border-color:rgba(255,255,255,0.06); transform:scale(1.08) }
    .emoji-option:active{ transform:scale(.96) }
    input[type="text"]{width:100%; padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit}
    .small {font-size:13px;color:var(--muted)}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03); text-align:left; font-size:13px}
    th{color:var(--muted);font-weight:600}
    .history-row-actions{display:flex;gap:6px;justify-content:flex-end}
    .trash{background:transparent;border:0;color:#ff9b9b;padding:6px;border-radius:8px;cursor:pointer}
    .stats{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .stat{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:8px 12px;border-radius:10px; min-width:120px}
    .quote-banner{margin-top:10px;padding:10px;border-radius:10px;background:linear-gradient(90deg, rgba(255,112,112,0.06), rgba(255,255,255,0.01)); color: #ffdfe0; font-weight:600}
    .muted-note{color:var(--muted);font-size:13px;margin-top:6px}

    /* responsive */
    @media (max-width:880px){
      .container{grid-template-columns:1fr; padding-bottom:40px}
    }
  </style>
</head>
<body>

  <header>
    <div>
      <h1>‚ù§Ô∏è Mental Health & Wellness Journal</h1>
      <div class="small">Log moods with emojis ‚Ä¢ auto quote generator ‚Ä¢ local-first</div>
    </div>

    <div class="controls top-actions">
      <button id="downloadCSV">Download CSV</button>
      <button id="clearAll" class="secondary">Clear All</button>
    </div>
  </header>

  <div class="container">
    <div class="card">
      <label>Select Mood</label>
      <div id="emojiContainer" aria-label="mood choices">
        <div class="emoji-option" data-value="1" title="Very sad">üò¢</div>
        <div class="emoji-option" data-value="2" title="Sad/low">üòï</div>
        <div class="emoji-option" data-value="3" title="Okay">üôÇ</div>
        <div class="emoji-option" data-value="4" title="Happy">üòä</div>
        <div class="emoji-option" data-value="5" title="Very happy">üòÑ</div>
      </div>

      <input type="hidden" id="moodValue">
      <label class="small">Notes / Activity (optional)</label>
      <input id="notes" type="text" placeholder="What were you doing?">

      <div style="display:flex; gap:8px; margin-top:12px">
        <button id="saveBtn">Save Entry</button>
      </div>

      <div class="quote-banner" id="liveQuote">Select an emoji to see a tailored quote.</div>
      <div class="muted-note">Tip: click an emoji to animate it ‚Äî your selection will be used in charts and history.</div>
    </div>

    <div>
      <div class="card" style="margin-bottom:12px">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div>
            <strong>Recent Entries</strong>
            <div class="small">Entries are stored in your browser (localStorage).</div>
          </div>
          <div class="small">Entries: <span id="entryCount">0</span></div>
        </div>

        <table aria-live="polite" id="historyTable">
          <thead>
            <tr><th style="width:160px">Date</th><th>Mood</th><th>Notes</th><th>Quote</th><th style="text-align:right">Action</th></tr>
          </thead>
          <tbody id="historyBody"><tr><td colspan="5" class="small">No entries yet.</td></tr></tbody>
        </table>
      </div>

      <div class="card" style="margin-bottom:12px">
        <div style="display:flex; gap:12px; align-items:center; justify-content:space-between">
          <strong>Analytics</strong>
          <div class="small">Last 7 days</div>
        </div>

        <div class="stats" id="analyticsTiles">
          <div class="stat">
            <div class="small">Weekly average</div>
            <div id="weeklyAvg" style="font-weight:700;font-size:18px">‚Äî</div>
          </div>
          <div class="stat">
            <div class="small">Most frequent mood</div>
            <div id="freqMood" style="font-weight:700;font-size:18px">‚Äî</div>
          </div>
          <div class="stat">
            <div class="small">Entries this week</div>
            <div id="weekCount" style="font-weight:700;font-size:18px">0</div>
          </div>
        </div>

        <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:220px">
            <canvas id="lineChart" height="160"></canvas>
          </div>
          <div style="width:200px">
            <canvas id="pieChart" height="160"></canvas>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    const QUOTES = {
      low: [
        "It's okay to feel this way. You're allowed to rest.",
        "You don't have to be perfect to be worthy of care.",
        "Small steps count ‚Äî one breath at a time."
      ],
      mid: [
        "Keep going ‚Äî small progress is still progress.",
        "You're doing better than you think.",
        "Balance is built from tiny consistent acts."
      ],
      high: [
        "You're shining ‚Äî celebrate the little wins!",
        "Keep that energy ‚Äî it's contagious in the best way.",
        "Enjoy this moment of brightness ‚Äî you earned it."
      ]
    };

    const EMOJI_MAP = {
      1: "üò¢", 2: "üòï", 3: "üôÇ", 4: "üòä", 5: "üòÑ"
    };

    const STORAGE_KEY = "mhwj_mood_data_v1";

    function readData(){
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
      } catch(e){
        console.warn("corrupt local data", e);
        return [];
      }
    }
    function writeData(d){ localStorage.setItem(STORAGE_KEY, JSON.stringify(d)); }

    function saveEntryToStorage(entry){
      const d = readData();
      d.push(entry);
      writeData(d);
    }
    function deleteEntryAt(index){
      const d = readData(); d.splice(index,1); writeData(d);
    }
    function clearAll(){
      localStorage.removeItem(STORAGE_KEY);
    }

    
    const emojis = document.querySelectorAll(".emoji-option");
    const moodValueInput = document.getElementById("moodValue");
    const liveQuote = document.getElementById("liveQuote");

    emojis.forEach(e => {
      e.addEventListener("click", () => {
        emojis.forEach(x => x.classList.remove("selected"));
        e.classList.add("selected");
        const v = Number(e.dataset.value);
        moodValueInput.value = v;
        // quick pulse animation
        e.animate([
          { transform: "scale(1)" },
          { transform: "scale(1.18)" },
          { transform: "scale(1)" }
        ], { duration: 320, easing: "cubic-bezier(.2,.9,.3,1)" });

        // update quote preview
        liveQuote.textContent = getQuoteForMood(v);
      });
    });

    /***********************
     * Quote selection     *
     ***********************/
    function getQuoteForMood(mood){
      mood = Number(mood);
      if(mood <= 2) return QUOTES.low[Math.floor(Math.random()*QUOTES.low.length)];
      if(mood === 3) return QUOTES.mid[Math.floor(Math.random()*QUOTES.mid.length)];
      return QUOTES.high[Math.floor(Math.random()*QUOTES.high.length)];
    }

    /***********************
     * Save / Delete / CSV *
     ***********************/
    const saveBtn = document.getElementById("saveBtn");
    const notesInput = document.getElementById("notes");
    const historyBody = document.getElementById("historyBody");
    const entryCountEl = document.getElementById("entryCount");
    const clearAllBtn = document.getElementById("clearAll");
    const downloadCSVBtn = document.getElementById("downloadCSV");

    saveBtn.addEventListener("click", () => {
      const mood = Number(moodValueInput.value);
      const notes = notesInput.value.trim();
      if(!mood || !EMOJI_MAP[mood]) { alert("Please select a mood emoji."); return; }
      const date = new Date().toISOString();
      const quote = getQuoteForMood(mood);
      const entry = { date, mood, notes, quote };
      saveEntryToStorage(entry);
      notesInput.value = ""; moodValueInput.value = ""; emojis.forEach(x=>x.classList.remove("selected"));
      liveQuote.textContent = "Saved ‚Äî select another emoji to preview a quote.";
      renderAll();
      // small visual confirmation
      saveBtn.animate([{ transform:"translateY(0)" }, { transform:"translateY(-4px)" }, { transform:"translateY(0)" }], {duration:300});
    });

    clearAllBtn.addEventListener("click", () => {
      if(!confirm("Clear ALL entries? This cannot be undone.")) return;
      clearAll();
      renderAll();
    });

    function downloadCSV(){
      const data = readData();
      if(!data.length){ alert("No entries to download."); return; }
      // CSV header
      const rows = [["date","mood_value","mood_emoji","notes","quote"]];
      data.forEach(r => {
        rows.push([r.date, r.mood, EMOJI_MAP[r.mood] || "", (r.notes||"").replace(/\n/g," "), (r.quote||"").replace(/\n/g," ")]);
      });
      const csv = rows.map(r => r.map(cell => `"${(String(cell)).replace(/"/g,'""')}"`).join(",")).join("\n");
      const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `mood_history_${new Date().toISOString().slice(0,10)}.csv`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    downloadCSVBtn.addEventListener("click", downloadCSV);

    /***********************
     * Render / Charts     *
     ***********************/
    let lineChart = null, pieChart = null;
    const lineCtx = document.getElementById("lineChart").getContext("2d");
    const pieCtx = document.getElementById("pieChart").getContext("2d");

    function prettyDate(iso){
      const d = new Date(iso);
      return d.toLocaleString();
    }

    function renderAll(){
      const data = readData();
      // History table
      if(!data.length){
        historyBody.innerHTML = `<tr><td colspan="5" class="small">No entries yet.</td></tr>`;
      } else {
        historyBody.innerHTML = "";
        // show newest first
        data.slice().reverse().forEach((e, revIndex) => {
          // compute original index for delete mapping
          const originalIndex = data.length - 1 - revIndex;
          const row = document.createElement("tr");
          row.innerHTML = `
            <td style="min-width:160px">${prettyDate(e.date)}</td>
            <td style="font-size:18px">${EMOJI_MAP[e.mood]||"‚Äî"}</td>
            <td>${(e.notes||"")}</td>
            <td style="max-width:240px">${(e.quote||"")}</td>
            <td style="text-align:right"><div class="history-row-actions">
              <button class="trash" data-index="${originalIndex}" title="Delete entry">üóë</button>
            </div></td>
          `;
          historyBody.appendChild(row);
        });

        // attach delete handlers
        historyBody.querySelectorAll(".trash").forEach(btn => {
          btn.addEventListener("click", (ev) => {
            const idx = Number(btn.dataset.index);
            if(confirm("Delete this entry?")) {
              deleteEntryAt(idx);
              renderAll();
            }
          });
        });
      }

      // count
      entryCountEl.textContent = data.length;

      // Charts & stats
      updateCharts(data);
    }

    function updateCharts(data){
      // line chart: time series of moods
      const labels = data.map(d => (new Date(d.date)).toLocaleDateString());
      const values = data.map(d => Number(d.mood));

      if(lineChart) lineChart.destroy();
      lineChart = new Chart(lineCtx, {
        type: 'line',
        data: { labels, datasets: [{ label: 'Mood (1-5)', data: values, fill:false, tension:0.3, pointRadius:4 }] },
        options: { plugins:{legend:{display:false}}, scales:{ y:{ min:1, max:5, ticks:{stepSize:1}} } }
      });

      // pie chart: frequency
      const counts = [0,0,0,0,0,0]; // index by mood
      data.forEach(d => counts[d.mood] = (counts[d.mood]||0) + 1);
      const pieData = [counts[1],counts[2],counts[3],counts[4],counts[5]];
      if(pieChart) pieChart.destroy();
      pieChart = new Chart(pieCtx, {
        type:'pie',
        data:{ labels:["üò¢","üòï","üôÇ","üòä","üòÑ"], datasets:[{ data: pieData }] },
        options:{ plugins:{legend:{position:'bottom'} } }
      });

      // Weekly analytics (last 7 days)
      const oneWeekAgo = Date.now() - (7*24*60*60*1000);
      const lastWeek = data.filter(d => new Date(d.date).valueOf() >= oneWeekAgo);
      const weekCount = lastWeek.length;
      document.getElementById("weekCount").textContent = weekCount;

      if(weekCount === 0){
        document.getElementById("weeklyAvg").textContent = "‚Äî";
        document.getElementById("freqMood").textContent = "‚Äî";
      } else {
        const avg = (lastWeek.reduce((s,d)=>s+Number(d.mood),0) / weekCount);
        document.getElementById("weeklyAvg").textContent = avg.toFixed(2) + " / 5";

        // frequent mood
        const freq = {};
        lastWeek.forEach(d => { freq[d.mood] = (freq[d.mood]||0) + 1; });
        const most = Object.keys(freq).sort((a,b)=>freq[b]-freq[a])[0];
        document.getElementById("freqMood").textContent = EMOJI_MAP[most] + " ("+freq[most]+")";
      }
    }

    function init(){
      renderAll();
    }

    // initial load
    window.addEventListener("load", init);
  </script>
</body>
</html>
